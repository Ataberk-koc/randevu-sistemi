// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 1. KULLANICILAR (Hem Müşteri Hem Admin)
model User {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  name      String
  email     String   @unique
  phone     String   @unique // Randevu için telefon şart
  password  String   // Şifreli tutulacak
  role      Role     @default(CUSTOMER) // Müşteri mi Admin mi?

  appointments Appointment[] // Müşterinin randevuları
}

// 2. HİZMETLER (Örn: Saç Kesimi, Cilt Bakımı)
model Service {
  id          String   @id @default(uuid())
  name        String
  description String?
  duration    Int      // Dakika cinsinden (Örn: 45)
  price       Decimal  // Baz fiyat (Örn: 500.00)
  isActive    Boolean  @default(true)
  bufferTime  Int      @default(0)
  appointments Appointment[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// 3. ÜRÜNLER (Randevuda satılabilecek ekstralar)
model Product {
  id          String   @id @default(uuid())
  name        String
  price       Decimal
  taxRate     Int      // KDV Oranı (Örn: 20)
  stock       Int      // Stok takibi için
  isActive    Boolean  @default(true)
}

// 4. RANDEVULAR (Ana Tablo)
model Appointment {
  id          String            @id @default(uuid())
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  
  date        DateTime          // Randevu Başlangıç Tarihi ve Saati
  endDate     DateTime          // Bitiş saati (date + service.duration)
  
  status      AppointmentStatus @default(PENDING) // Onay bekliyor, Onaylandı, İptal...
  
  // İlişkiler
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  
  serviceId   String
  service     Service  @relation(fields: [serviceId], references: [id])

  // Fatura Detayları (Adisyon Kalemleri)
  items       AppointmentItem[] 
  
  notes       String?  // Müşterinin notu
  adminNotes  String?  // Admin'in özel notu (Müşteri görmez)
}

// 5. ADİSYON KALEMLERİ (Hizmet + Ek Ürünlerin toplandığı yer)
// Bu tablo sayesinde randevu bittikten sonra fiyat değişse bile geçmiş kayıt bozulmaz.
model AppointmentItem {
  id            String      @id @default(uuid())
  appointmentId String
  appointment   Appointment @relation(fields: [appointmentId], references: [id], onDelete: Cascade)
  
  name          String      // O anki ürün/hizmet adı
  type          ItemType    // SERVICE veya PRODUCT
  
  quantity      Int         @default(1)
  unitPrice     Decimal     // O anki birim fiyat
  taxRate       Int         // O anki KDV oranı
  totalPrice    Decimal     // (unitPrice * quantity)
}

// ENUMERATIONS (Sabit Seçenekler)
enum Role {
  CUSTOMER
  ADMIN
  STAFF
}

enum AppointmentStatus {
  PENDING   // Onay Bekliyor
  APPROVED  // Onaylandı (Takvimi kapatır)
  REJECTED  // Reddedildi
  COMPLETED // Tamamlandı (Hizmet verildi)
  CANCELLED // Müşteri iptal etti
  NOSHOW    // Gelmedi
}

enum ItemType {
  SERVICE
  PRODUCT
}

// HAFTALIK ÇALIŞMA PLANI (Genel Ayarlar)
model WorkingDay {
  id        String   @id @default(uuid())
  dayOfWeek Int      @unique // 0: Pazar, 1: Pazartesi ... 6: Cumartesi
  startTime String   // Örn: "09:00"
  endTime   String   // Örn: "18:00"
  isClosed  Boolean  @default(false) // O gün tamamen kapalı mı?
}

// ÖZEL KAPALI GÜNLER (Tatiller)
model DayOff {
  id        String   @id @default(uuid())
  date      DateTime @unique // Hangi tarih kapalı?
  reason    String?  // Neden? (Örn: Resmi Tatil)
}